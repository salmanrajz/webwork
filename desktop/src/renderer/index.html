<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>WebWork Tracker</title>
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; img-src 'self' data:; style-src 'self' 'unsafe-inline'" />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div id="notification-permission-banner" class="hidden banner warning" role="alert">
      <div class="banner-content">
        <span data-i18n="notifications.disabledWarning">Notifications are disabled. Some alerts may not be visible.</span>
        <div class="banner-actions">
          <button id="recheck-notification-permission" class="btn btn-secondary" data-i18n="notifications.retry" type="button">Retry</button>
          <button id="open-notification-settings" class="btn btn-tertiary" data-i18n="notifications.openSettings" type="button">Open Settings</button>
        </div>
      </div>
    </div>
    <main id="app">
      <section id="auth">
        <h1>WebWork Tracker</h1>
        <p class="subtitle">Log in with your WebWork credentials to begin tracking.</p>
        <form id="login-form">
          <label>Email <input type="email" id="email" required /></label>
          <label>Password <input type="password" id="password" required /></label>
          <button type="submit">Sign in</button>
        </form>
        <p id="auth-error" class="error hidden"></p>
      </section>

      <section id="tracker" class="hidden">
        <header class="header-section">
          <div>
            <h2 id="user-name"></h2>
            <p id="user-role"></p>
          </div>
          <div class="header-controls">
            <button id="analytics-btn" class="analytics-btn" title="View Analytics">
              üìä
            </button>
            <button id="productivity-btn" class="productivity-btn" title="Productivity Insights">
              üéØ
            </button>
            <button id="settings-btn" class="settings-btn" title="Break Settings">
              ‚öôÔ∏è
            </button>
            <button id="theme-toggle" class="theme-toggle" title="Toggle dark mode">
              <span class="theme-icon">üåô</span>
            </button>
            <button id="notification-btn" class="notification-btn" title="Notifications">
              üîî
              <span id="notification-count" class="notification-count hidden">0</span>
            </button>
            <button id="logout">Sign out</button>
          </div>
        </header>

        <div class="status-card tracker-section">
          <p class="label">Current status</p>
          <p id="status" class="value">Idle</p>
          <p id="status-note" class="note"></p>
          <div id="timer-display" class="timer-display hidden">
            <p class="label">Elapsed Time</p>
            <p id="elapsed-time" class="value">00:00:00</p>
          </div>
          <div id="tab-switch-indicator" class="tab-switch-info hidden">
            <p class="label">Tab Activity</p>
            <p id="switch-count" class="value">0 switches</p>
            <p id="last-switch" class="note"></p>
          </div>
        </div>

        <div class="attendance-card attendance-section">
          <div class="attendance-info">
            <p class="label">Attendance</p>
            <p id="attendance-state" class="value">Not clocked in</p>
            <p id="attendance-note" class="note"></p>
          </div>
            <button id="clock-toggle" class="secondary">Clock In</button>
        </div>

        <div class="control-group tasks-section">
          <label for="task-select">Select task</label>
          <select id="task-select"></select>
        </div>

        <div class="buttons tasks-section">
          <button id="start" class="primary">Start</button>
          <button id="pause">Pause</button>
          <button id="resume">Resume</button>
          <button id="stop" class="danger">Stop</button>
        </div>

        <div class="log" id="event-log"></div>
      </section>
    </main>

    <!-- Break Settings Modal -->
    <div id="break-settings-modal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h3>‚öôÔ∏è Break Settings</h3>
          <button id="close-settings" class="close-btn">&times;</button>
        </div>
        <div class="modal-body">
          <div class="setting-group">
            <label for="break-enabled">
              <input type="checkbox" id="break-enabled" checked>
              Enable Break Reminders
            </label>
          </div>
          <div class="setting-group">
            <label for="break-interval">Break Reminder Interval (minutes):</label>
            <input type="number" id="break-interval" min="15" max="180" value="60">
          </div>
          <div class="setting-group">
            <label for="daily-target">Daily Target Hours:</label>
            <input type="number" id="daily-target" min="1" max="24" value="8" step="0.5">
          </div>
        </div>
        <div class="modal-footer">
          <button id="save-settings" class="btn btn-primary">Save Settings</button>
          <button id="cancel-settings" class="btn btn-secondary">Cancel</button>
        </div>
      </div>
    </div>

    <!-- Analytics Modal -->
    <div id="analytics-modal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h3>üìä Analytics</h3>
          <button id="close-analytics" class="close-btn">&times;</button>
        </div>
        <div class="modal-body">
          <div class="analytics-content">
            <p>Analytics features coming soon...</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Productivity Insights Modal -->
    <div id="productivity-modal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h3>üéØ Productivity Insights</h3>
          <button id="close-productivity" class="close-btn">&times;</button>
        </div>
        <div class="modal-body">
          <div class="productivity-content">
            <p>Productivity insights coming soon...</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Notifications Modal -->
    <div id="notifications-modal" class="modal hidden">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Notifications</h3>
          <button id="close-notifications" class="close-btn">‚úï</button>
        </div>
        <div class="modal-body">
          <div id="notifications-list" class="notifications-list">
            <p class="no-notifications">No notifications yet</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Permission Guidance Modal -->
    <div id="permission-modal" class="modal hidden" role="dialog" aria-labelledby="permission-modal-title">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="permission-modal-title" data-i18n="permissions.title">Permissions Required</h3>
          <button id="close-permission-modal" class="close-btn" aria-label="Close">‚úï</button>
        </div>
        <div class="modal-body">
          <p class="modal-intro" data-i18n="permissions.subtitle">We need a few system permissions to keep WebWork Tracker running smoothly.</p>
          <div id="permission-steps"></div>
          <div class="permission-actions">
            <button id="open-system-preferences" class="btn btn-primary" data-i18n="permissions.openSettings">Open System Preferences</button>
            <button id="refresh-permission-status" class="btn btn-secondary" data-i18n="permissions.refresh">Refresh Status</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Compliance Consent Modal -->
    <div id="consent-modal" class="modal hidden" role="dialog" aria-labelledby="consent-modal-title">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="consent-modal-title" data-i18n="consent.title">Before we begin</h3>
        </div>
        <div class="modal-body">
          <p class="modal-intro" data-i18n="consent.description">
            WebWork Tracker captures screenshots, activity metrics, and location data during work hours. Please review and accept to continue.
          </p>
          <ul class="consent-list">
            <li data-i18n="consent.screenshots">Screenshots of your primary display may be taken while tracking.</li>
            <li data-i18n="consent.activity">Keyboard and mouse activity counts are recorded‚Äînever full keystrokes.</li>
            <li data-i18n="consent.location">Location tracking occurs only during active sessions (if enabled by your organization).</li>
          </ul>
          <p class="modal-links" data-i18n="consent.links">
            Review our <a href="/privacy-policy" target="_blank" rel="noreferrer">Privacy Policy</a> and <a href="/terms-of-service" target="_blank" rel="noreferrer">Terms of Service</a>.
          </p>
          <label class="consent-checkbox">
            <input type="checkbox" id="consent-checkbox" />
            <span data-i18n="consent.acknowledge">I understand and agree to the monitoring described above.</span>
          </label>
        </div>
        <div class="modal-footer">
          <button id="consent-decline" class="btn btn-secondary" data-i18n="consent.decline">Decline</button>
          <button id="consent-accept" class="btn btn-primary" data-i18n="consent.accept" disabled>Accept & Continue</button>
        </div>
      </div>
    </div>

    <script src="renderer.js"></script>
  </body>
</html>
